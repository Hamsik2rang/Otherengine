# 개발 셋업

[English](../English/Development%20Setup.md)

## 게임 프로젝트 구성

### 게임 프로젝트 폴더 만들기

폴더 이름은 상관 없으나, 게임 이름으로 하는 것이 좋을 것입니다. 여기서는 TestGame으로 하겠습니다.

```text
◢ TestGame
```

### Otherengine 추가

Otherengine을 Engine 폴더에 추가합니다. 여기서는 git submodule를 이용하겠습니다. 이렇게 하면 엔진 업데이트를 편하게 할 수 있습니다.

```shell
TestGame$ git init
TestGame$ git submodule add -b buildable https://github.com/Othereum/Otherengine Engine --depth 1
```

```text
◢ TestGame
  ◢ Engine
    ▷ CMake
    ▷ Config
    ▷ Guide
    ▷ Scripts
      ...
    .gitmodules
```

### CMakeLists.txt 작성

```text
◢ TestGame
  ▷ Engine
    .gitmodules
    CMakeLists.txt
```

```cmake
cmake_minimum_required(VERSION 3.14)
project("TestGame")
add_subdirectory("Engine")
```

이 세 줄만 작성하면 엔진 내부 CMakeLists.txt가 알아서 빌드 구성을 해줍니다.

### 모듈 구성

TestGame/Source/TestGame에 Public과 Private 폴더를 만듭니다.

```text
◢ TestGame
  ▷ Engine
  ◢ Source
    ◢ TestGame
      ◢ Public
      ◢ Private
    .gitmodules
    CMakeLists.txt
```

Source 디렉토리에 있는 폴더는 모듈을 의미합니다. 프로젝트 이름과 동일한 이름의 폴더는 자동으로 게임 모듈이 되어 빌드 대상에 추가됩니다. 여기서는 TestGame이 됩니다. 원한다면 커스텀 모듈을 추가할 수 있지만, 자동으로 빌드 대상에 추가되지는 않기 때문에 직접 CMakeLists.txt에 추가해야 합니다.

각 모듈의 Private 폴더에는 모듈 내부에서만 사용할 소스, Public 폴더에는 모듈 외부에 공개할 소스가 들어갑니다. 그래서 일반적으로 .cpp 파일은 Private에, .hpp 파일은 Public에 넣습니다. Private 안의 모든 .cpp 파일은 자동으로 빌드 대상에 추가되며, Public 폴더는 해당 모듈을 사용하는 모듈과 자기 자신의 include 디렉토리에 추가됩니다.

### 모듈 구현

cpp 파일을 만들어 게임 모듈을 작성합니다.

```text
◢ TestGame
  ▷ Engine
  ◢ Source
    ◢ TestGame
      ◢ Public
      ◢ Private
          TestGame.cpp
    .gitmodules
    CMakeLists.txt
```

```cpp
#include <Engine.hpp>

using namespace oeng;

DEFINE_GAME_MODULE(Test Game);

GAME_API void GameMain(Engine&)
{
}
```

## 의존성 설치

항목 | 최소 버전 | 자동 설치
--- | --- | ---
MSVC\* | 14.26 | X
Clang\* | 10 | `Generate.sh` - `apt`
GCC\* | 10 | `Generate.sh` - `apt`
[CMake](https://cmake.org/download) | 3.14 | `InstallDeps.sh` - `wget`

\* *셋 중 하나만 있으면 됩니다.*

항목 | 최소 버전 | 자동 설치
--- | --- | ---
[{fmt}](https://github.com/fmtlib/fmt) | 7.0.0 | CMakeLists.txt - git
[spdlog](https://github.com/gabime/spdlog) | 1.7.0 | CMakeLists.txt - git
[nlohmann-json](https://github.com/nlohmann/json) | 3.8.0 | CMakeLists.txt - git
[SDL2](https://www.libsdl.org/download-2.0.php) | | `InstallDeps.sh` - `apt`
[GLEW](https://github.com/nigels-com/glew) | | `InstallDeps.sh` - `apt`
[SOIL2](https://github.com/SpartanJ/SOIL2) | | CMakeLists.txt - git
[omem](https://github.com/Othereum/omem) | | CMakeLists.txt - git
[otm](https://github.com/Othereum/otm) | | CMakeLists.txt - git

- Linux

  Shell에 아래 명령을 입력하면 됩니다:

  ```shell
  TestGame$ Engine/Scripts/InstallDeps.sh
  ```

- Windows

  Windows에서는 스크립트를 사용할 수 없습니다. 라이브러리를 설치하려면 [vcpkg](https://github.com/microsoft/vcpkg)를 사용하세요.

  > **주의**: vcpkg의 기본 triplet은 x86-windows입니다. x64 패키지를 설치하려면 직접 명시해주어야 합니다.  
  > 예) `vcpkg install sdl2:x64-windows glew:x64-windows`
  >
  > 기본 triplet을 변경하는 방법도 있습니다. 시스템 환경변수 `VCPKG_DEFAULT_TRIPLET`의 값을 `x64-windows`로 설정하면 됩니다.

> **팁**: 웬만하면 수동으로 설치하세요. CMakeLists.txt 자동 설치는 빌드 속도를 저하시킵니다.

## 생성 및 빌드

- Linux

  - 생성

    ```shell
    TestGame$ Engine/Scripts/Generate.sh [compiler] [cmake_args...]
    ```

    - `[compiler]`: 사용할 컴파일러를 지정합니다. gcc 또는 clang을 지정할 수 있습니다. 기본값은 clang입니다.
    - `[cmake_args...]`: CMake로 전달되는 추가 명령줄 옵션입니다.

  - 빌드

    ```shell
    TestGame$ Engine/Scripts/Build.sh [compiler] [cmake_args] [build_args]
    ```

    - `[compiler]`: 사용할 컴파일러를 지정합니다.
    - `[cmake_args]`: CMake로 전달되는 추가 명령줄 옵션입니다. 여러 개인 경우 따옴표로 묶어야 합니다.
    - `[build_args]`: -- 뒤에 전달되는 네이티브 빌드 스위치를 지정합니다. 여러 개인 경우 따옴표로 묶어야 합니다.

- Windows

  Visual Studio를 사용하면 쉽고 간단하게 빌드할 수 있습니다. 자세한 내용은 [Visual Studio의 CMake 프로젝트](https://docs.microsoft.com/ko-kr/cpp/build/cmake-projects-in-visual-studio?view=vs-2019)를 확인하세요.

위 과정을 모두 완료하면 Windows에서는 빌드 결과물이 이렇게 나올 것입니다:

```text
◢ TestGame
  ◢ Binaries
      Otherengine-Core.dll
      Othrengine-Engine.dll
      Otherengine-Renderer.dll
      TestGame.exe
      TestGame-Module.dll
      ...
  ▷ Engine
  ▷ out
  ▷ Source
    .gitmodules
    CMakeLists.txt
    CMakeSettings.json
    ...
```

빌드 결과물은 모두 Binaries에 저장됩니다. 실험삼아 TestGame.exe를 실행해보세요. 잘 작동한다면, 아직은 아무것도 없으니 검은 화면이 보일 것입니다.

됐습니다! 이렇게 해서 개발 셋업을 마쳤습니다. 이제 본격적으로 개발을 시작하실 수 있습니다.
